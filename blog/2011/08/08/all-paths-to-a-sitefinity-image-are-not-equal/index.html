
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>All Paths to a Sitefinity Image are not Equal - Welcome to My Nerditorium</title>
  <meta name="author" content="Daniel Auger">

  
  <meta name="description" content="Recently, while doing a performance pass through a Sitefinity 4 application, I noticed that a public facing page had an unusually slow load time. Of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nerditorium.danielauger.com/blog/2011/08/08/all-paths-to-a-sitefinity-image-are-not-equal/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Welcome to My Nerditorium" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37319998-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Welcome to My Nerditorium</a></h1>
  
    <h2>Thoughts on coding, gaming, and nerdy media.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:nerditorium.danielauger.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/categories/links">10,000 Links</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">All Paths to a Sitefinity Image Are Not Equal</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-08T15:41:00-05:00" pubdate data-updated="true">Aug 8<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Recently, while doing a performance pass through a Sitefinity 4 application, I noticed that a public facing page had an unusually slow load time. Of course, the first thing I did was open up Firebug to see where the time was being spent. To my surprise, the majority of the time was spent waiting for the initial response from the server. After a little digging, I narrowed down the time-sink to a custom widget that pulled images from a Sitefinity image album. In particular, the query to figure out which images to display was the source of slothness. <!-- more --></p>

<p>A few things to note:</p>

<ul>
<li>There were about 250 image albums in the CMS (all but 5 or so of them were empty at the time of discovery, however).</li>
<li>There were roughly 30 images in the album we were querying against.</li>
<li>When the original query was written, there were only a few images in the system, and that is why the issue wasn’t apparent right when the query was written.
Here’s an approximation of the original call to retrieve the images through the Sitefinity API:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">var</span> <span class="n">libManager</span> <span class="p">=</span> <span class="n">LibrariesManager</span><span class="p">.</span><span class="n">GetManager</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">imagesFromFoo</span> <span class="p">=</span> <span class="n">libManager</span><span class="p">.</span><span class="n">GetImages</span><span class="p">()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="n">i</span><span class="p">.</span><span class="n">Album</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">&amp;&amp;</span> <span class="n">i</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">ContentLifecycleStatus</span><span class="p">.</span><span class="n">Live</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this bit of code, we are querying for all images that belong to the image album named “Foo”. Note that the query is structured in a way where we query through the image object to determine what album it belongs to.</p>

<p>The above query took about 2 seconds to return roughly 30 Sitefinity Image objects. This would not do. Therefore, I took to tweaking the query. I tried several different things while maintaining the original approach, but since Sitefinity’s LINQ provider isn’t a complete implementation, I couldn’t make much headway.</p>

<p>I eventually decided to rethink the approach and query for the images by going in through the album instead of going through the image object.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">var</span> <span class="n">libManager</span> <span class="p">=</span> <span class="n">LibrariesManager</span><span class="p">.</span><span class="n">GetManager</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">imagesFromFoo</span> <span class="p">=</span> <span class="n">libManager</span><span class="p">.</span><span class="n">GetAlbums</span><span class="p">()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">))</span>
</span><span class='line'>        <span class="p">.</span><span class="n">First</span><span class="p">()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Images</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">ContentLifecycleStatus</span><span class="p">.</span><span class="n">Live</span><span class="p">)</span>
</span><span class='line'>               <span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>This reduced the query time down to about .2 seconds.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Daniel Auger</span></span>

      








  


<time datetime="2011-08-08T15:41:00-05:00" pubdate data-updated="true">Aug 8<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>development</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://nerditorium.danielauger.com/blog/2011/08/08/all-paths-to-a-sitefinity-image-are-not-equal/" data-via="danielauger" data-counturl="http://nerditorium.danielauger.com/blog/2011/08/08/all-paths-to-a-sitefinity-image-are-not-equal/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/05/15/matt-chat-the-youtube-channel-you-should-be-watching-if-you-played-video-games-in-the-80s-or-90s/" title="Previous Post: Matt Chat - The YouTube Channel You Should be Watching if You Played Video Games in the 80s or 90s">&laquo; Matt Chat - The YouTube Channel You Should be Watching if You Played Video Games in the 80s or 90s</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/11/30/your-asp-dot-net-dot-star-project-is-not-just-your-ui-layer/" title="Next Post: Your ASP.NET.* Project is Not Just Your UI Layer">Your ASP.NET.* Project is Not Just Your UI Layer &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/06/22/the-land-of-10-000-links-number-88/">The Land of 10,000 Links #88</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/22/setting-up-an-existing-octopress-blog-on-a-new-computer/">Setting up an Existing Octopress Blog on a New Computer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/17/the-land-of-10-000-links-number-87/">The Land of 10,000 Links #87</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/16/the-land-of-10-000-links-number-86/">The Land of 10,000 Links #86</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/14/the-land-of-10-000-links-number-85/">The Land of 10,000 Links #85</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/bash/'>bash (1)</a></li>
<li class='category'><a href='/blog/categories/development/'>development (13)</a></li>
<li class='category'><a href='/blog/categories/links/'>links (88)</a></li>
<li class='category'><a href='/blog/categories/meta/'>meta (2)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (1)</a></li>
<li class='category'><a href='/blog/categories/osx/'>osx (1)</a></li>
<li class='category'><a href='/blog/categories/pebkac/'>pebkac (1)</a></li>
<li class='category'><a href='/blog/categories/retro-computing-and-gaming/'>retro computing and gaming (1)</a></li>
<li class='category'><a href='/blog/categories/tdd/'>tdd (3)</a></li>
<li class='category'><a href='/blog/categories/ubuntu/'>ubuntu (1)</a></li>
<li class='category'><a href='/blog/categories/webapi/'>webapi (1)</a></li>

  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("danielauger", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/danielauger" class="twitter-follow-button" data-show-count="false">Follow @danielauger</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/"><img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-nc-sa/3.0/us/80x15.png" /></a> Copyright &copy; 2008 - 2013 | Daniel Auger |
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<p>
Disclaimer: The opinions expressed herein are my own personal opinions and do not represent the views of my employer.
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nerditorium';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://nerditorium.danielauger.com/blog/2011/08/08/all-paths-to-a-sitefinity-image-are-not-equal/';
        var disqus_url = 'http://nerditorium.danielauger.com/blog/2011/08/08/all-paths-to-a-sitefinity-image-are-not-equal/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
